jQuery(document).ready(function(e){function t(){let t=477-(720-window.innerHeight),s="";e(".eckb-hd-header__logo").length&&(s=50);let a="";e("html").find(".epkb-editor-zone").length&&(a=32),t>477?(e("#eckb-hd-body-container").css("height",477-s-a),e(".eckb-hd-header__logo").show()):(e("#eckb-hd-body-container").css("height",t-a),e(".eckb-hd-header__logo").hide())}function s(t){let s=e("#eckb-help-dialog"),a="back"===t?parseInt(s.attr("data-step"))-1:t;1===a&&e("#epkb-hd__search-terms").val(""),s.attr("data-step",a)}function a(t){"number"==typeof t&&t>0&&(e("#eckb-help-dialog").attr("data-sub-step",t),e(".epkb-hd__search-results-title").removeClass("epkb-hd__search-results-title--active"),e(".epkb-hd__search-results-title[data-target-sub-step="+t+"]").addClass("epkb-hd__search-results-title--active"))}if(e(".eckb-hd-toggle").length){let e=jQuery(".eckb-hd-toggle").data("start-delay");setTimeout(function(){jQuery(".eckb-hd-toggle").show()},1e3*e)}e("#eckb-help-dialog").length&&(t(),window.addEventListener("resize",function(){t()})),e("body").on("click",".epkb-hd_article-item",function(t){t.preventDefault(),e("#epkb-hd_article-desc").css("height","");let i=e("help-dialog-iframe-styles").html(),l=e(this).data("url"),c=epkb_help_dialog_vars.article_preview_not_available;if(void 0===l||!l)return;let n=e(this).find(".epkb-hd_article-item__text").text();if(e(".epkb-hd_article-link").prop("href",l),e("#epkb-hd_article-desc").contents().find("body").html(""),0==e("#epkb-hd_article-desc").contents().find("link").length){e("head link").each(function(){if("stylesheet"!=e(this).prop("rel"))return!0;e(this).clone().appendTo(e("#epkb-hd_article-desc").contents().find("head"))}),e("head style").each(function(){e(this).clone().appendTo(e("#epkb-hd_article-desc").contents().find("head"))}),e("body link").each(function(){if("stylesheet"!=e(this).prop("rel"))return!0;e(this).clone().appendTo(e("#epkb-hd_article-desc").contents().find("head"))}),e("body style").each(function(){e(this).clone().appendTo(e("#epkb-hd_article-desc").contents().find("head"))}),e("#epkb-hd_article-desc").contents().find("head").append('<link rel="stylesheet" type="text/css" href="'+epkb_help_dialog_vars.help_iframe_styles+'">')}e.ajax({type:"GET",dataType:"html",url:l,beforeSend:function(t){e("#eckb-help-dialog").attr("data-prev-sub-step",e("#eckb-help-dialog").attr("data-sub-step")),a(4),e(".epkb-hd_article-desc").html("")}}).done(function(t){if(0==e(t).find("#eckb-article-content-body").length)return!0;let s=e(t).find("#eckb-article-content-body"),a=["br","ul","li","ol","h1","h2","h3","h4","h5","h6","p","b","strong","i","a","img"];s.find("*").each(function(){~a.indexOf(e(this).prop("tagName").toLowerCase())||(e(this).append(" "),e(this).contents().unwrap())}),s.find("*").each(function(){"img"!==e(this).prop("tagName").toLowerCase()&&""==e(this).html().trim()&&e(this).remove()}),s=(s=s.html()).replace(/<!--[\s\S]*?-->/g,""),c=s.split(" ").slice(0,500).join(" ");let i=document.createElement("div");i.innerHTML=c,e(i).find("*").each(function(){"img"!==e(this).prop("tagName").toLowerCase()&&""==e(this).html().trim()&&e(this).remove()}),c=e(i).html(),s.length>c.length&&(c+="...")}).always(function(){s(3),a(parseInt(e("#eckb-help-dialog").attr("data-prev-sub-step"))),e("#epkb-hd_article-desc").contents().find("body").html('<h1 class="epkb-hd_article-title">'+n+"</h1>"+c),e("#epkb-hd_article-desc").contents().find("html").addClass(e("#epkb-hd_article-desc").attr("data-active-theme-class")),e("#epkb-hd_article-desc").contents().find("body").addClass("epkb-hd_article-desc__body"),e("#epkb-hd_article-desc").contents().find("html head").append(i);let t=e("#epkb-hd_article-desc").contents().find("body").height(),l=0;e(".eckb-hd-header__logo").length&&(l=50),t<250?e("#epkb-hd_article-desc").height(290-l):e("#epkb-hd_article-desc").height(e("#epkb-hd_article-desc").contents().find("body").height())})}),e(".epkb-hd__faq__back-btn").on("click",function(e){s("back")}),e("body").on("input","#epkb-hd__search-terms",function(){e(this).val().length>=3&&(!function(t,i){let l=t,c=l.val(),n=l.data("kb-ids");setTimeout(function(){if(c===l.val()){let t={action:"epkb_help_dialog_search_kb",search_terms:c,kb_ids:n},i="",l="",d="";e.ajax({type:"POST",dataType:"json",url:epkb_help_dialog_vars.ajaxurl,data:t,beforeSend:function(e){s(2),a(4)}}).done(function(e){(e=e||"").error||"success"!==e.status?d=epkb_help_dialog_vars.msg_try_again:(e.no_results&&(d=e.no_results),e.faq_results&&(i=e.faq_results),e.article_results&&(l=e.article_results))}).fail(function(e,t,s){d=epkb_help_dialog_vars.msg_try_again+". ["+(s||epkb_help_dialog_vars.unknown_error)+"]"}).always(function(){e("#epkb-hd__search_results__errors").html('<div class="epkb-hd__search_results__no-results-container"> <div class="epkb-hd-no-results__msg">'+d+'</div><div class="epkb-hd-no-results__keywords"></div><div class="epkb-hd-no-results__hints"><p>Here are some hints:</p><ol><li>Dont use generic terms instead use specific ones.</li><li>Try using fewer words.</li><li>Make sure the spelling is correct.</li></ol></div></div>'),e("#epkb-hd__search_results__errors .epkb-hd-no-results__keywords").text(c),e("#epkb-hd__search_results__articles").html(l),e("#epkb-hd__search_results__faqs").html(i),s(2),a(d.length>0?3:e(i).find("div").length>0&&0===e(l).find("li").length?5:e(l).find("li").length>0&&0===e(i).find("div").length?6:1)})}},i)}(e(this),500),e(".eckb-hd-faq__list__item-container").removeClass("eckb-hd-faq__list__item--active"))}),e("#epkb-hd__search-terms").keyup(function(t){(!e(this).val()||e(this).val().length<3)&&e("#eckb-help-dialog").attr("data-step","1"),e(this).val()||e("#epkb-hd__search_results__faqs .eckb-hd-faq__list__item-container").show()}),e(".eckb-hd__breadcrumb_text").on("click",function(){s(parseInt(e(this).attr("data-target-step")))}),e(".epkb-hd__search-results-title").on("click",function(){s(2),a(parseInt(e(this).attr("data-target-sub-step"))),e(".epkb-hd__search-results-title").removeClass("epkb-hd__search-results-title--active"),e(this).addClass("epkb-hd__search-results-title--active")}),e(".eckb-hd-toggle").on("click",function(){e("#eckb-help-dialog").slideToggle(),e(".eckb-hd-toggle__icon").toggleClass("epkbfa-comments-o epkbfa-times"),e(this).toggleClass("eckb-hd-toggle--off eckb-hd-toggle--on"),e("#eckb-help-dialog").addClass("eckb-hd-toggle--check")}),e(document.body).on("click",".eckb-hd__item__question",function(t){let s=e(this).closest(".eckb-hd-faq__list__item-container");if(s.hasClass("epkb-hd__element--active"))return void s.removeClass("epkb-hd__element--active");s.parent().find(".eckb-hd-faq__list__item-container").removeClass("epkb-hd__element--active"),s.toggleClass("epkb-hd__element--active");document.querySelector(".eckb-hd-faq__list__item-container.epkb-hd__element--active").scrollIntoView({block:"start",behavior:"smooth"})}),e(".epkb-hd__contact-us__link").on("click",function(){e(".eckb-hd-tab[data-target-tab="+e(this).attr("data-target-tab")+"]").trigger("click")}),e(".eckb-hd-tab").on("click",function(){e("#eckb-help-dialog").attr("data-tab",e(this).attr("data-target-tab")),e(".eckb-hd-tab").removeClass("eckb-hd-tab--active"),e(this).addClass("eckb-hd-tab--active")}),e(document).on("submit","#epkb-hd__contact-form",function(t){if(t.preventDefault(),!e("#eckb-help-dialog").is(":visible")||e(".epkb-editor-preview").length)return;let s=e(this).serialize();s+="&jsnonce="+epkb_help_dialog_vars.nonce,e("#eckb-help-dialog").hasClass("eckb-hd-toggle--check")&&e.ajax({type:"POST",dataType:"json",url:epkb_help_dialog_vars.ajaxurl,data:s,beforeSend:function(t){e("#eckb-help-dialog").attr("data-prev-sub-step",e("#eckb-help-dialog").attr("data-sub-step")),a(4)}}).done(function(t){void 0!==t.success&&!1!==t.success?e(".epkb-hd__contact-form-response").html('<div class="epkb-hd__contact-form-response--success">'+t.data+"</div>"):void 0!==t.success&&!0===t.success?e(".epkb-hd__contact-form-response").html('<div class="epkb-hd__contact-form-response--success">'+t.data+"</div>"):void 0!==t.data&&t.data.length>5?e(".epkb-hd__contact-form-response").html('<div class="epkb-hd__contact-form-response--error">'+t.data+"</div>"):e(".epkb-hd__contact-form-response").html('<div class="epkb-hd__contact-form-response--error">'+epkb_help_dialog_vars.msg_try_again+"</div>")}).fail(function(t,s,a){e(".epkb-hd__contact-form-response").html('<div class="epkb-hd__contact-form-response--error">'+epkb_help_dialog_vars.msg_try_again+"</div>")}).always(function(){e(".epkb-hd__contact-form-response").show(),a(parseInt(e("#eckb-help-dialog").attr("data-prev-sub-step")))})})});