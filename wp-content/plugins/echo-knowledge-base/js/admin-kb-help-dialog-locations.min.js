jQuery(document).ready(function(e){function t(){0===e(".epkb-questions-list-container li").length&&0===e(".epkb-all-questions-list-container li").length?e("#epkb-admin__no-question-message").show():e("#epkb-admin__no-question-message").hide()}function o(t,o,a,s,p,l){let c,d;o=void 0===o?"epkb_callback_noop":o,e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,beforeSend:function(e){void 0!==l&&!1!==l||i("show",""),"object"==typeof l&&i("show","",l)}}).done(function(e){((d=e||"").error||void 0===d.message)&&(c=d.message?d.message:n("",epkb_vars.reload_try_again,"error"))}).fail(function(e,t,o){c=o?" ["+o+"]":epkb_vars.unknown_error,c=n(epkb_vars.error_occurred+". "+epkb_vars.msg_try_again,c,"error")}).always(function(){if(d=void 0===d?"":d,"function"==typeof p&&p(d),i("remove",""),c)return e(".eckb-bottom-notice-message").remove(),e("body").append(c).removeClass("fadeOutDown"),void setTimeout(function(){e(".eckb-bottom-notice-message").addClass("fadeOutDown")},1e4);"function"==typeof o?"undefined"===a?o(d):o(d,a):s&&location.reload()})}function i(t,o,i){if("show"===t){let t=void 0===i?"":"epkb-admin-dialog-box-loading--relative",n='<div class="epkb-admin-dialog-box-loading '+t+'"><div class="epkb-admin-dbl__header"><div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(o?'<div class="epkb-admin-text">'+o+"</div>":"")+'</div></div><div class="epkb-admin-dialog-box-overlay '+t+'"></div>';void 0===i?e("body").append(n):i.append(n)}else"remove"===t&&(e(".epkb-admin-dialog-box-loading").remove(),e(".epkb-admin-dialog-box-overlay").remove())}function n(e,t,o){return'<div class="eckb-bottom-notice-message"><div class="contents"><span class="'+o+'">'+(e?"<h4>"+e+"</h4>":"")+(t?"<p>"+t+"</p>":"")+'</span></div><div class="epkb-close-notice epkbfa epkbfa-window-close"></div></div>'}function a(t,o=""){e(".eckb-bottom-notice-message").remove(),e("body").append(n(o,t,"error")),setTimeout(function(){e(".eckb-bottom-notice-message").addClass("fadeOutDown")},1e4)}function s(t,o=""){e(".eckb-bottom-notice-message").remove(),e("body").append(n(o,t,"success")),setTimeout(function(){e(".eckb-bottom-notice-message").addClass("fadeOutDown")},1e4)}function p(t){0!=t.length&&e("html, body").animate({scrollTop:t.offset().top-100},300)}function l(){e("#epkb-admin__boxes-list__questions .epkb-admin__list-actions-row .epkb-success-btn").css({visibility:"visible"}),e("#epkb-admin__boxes-list__questions .epkb-admin__list-actions-row .epkb-error-btn").css({visibility:"visible"})}function c(t){b=setInterval(d,1e3);let i=tinymce.get("epkb_help_editor");if(void 0===t||!t)return e("#epkb_help_question").val(""),e("#epkb_help_question_id").val(0),e(".epkb-help-wp-editor").addClass("active"),i&&i.setContent(""),void e(".epkb-characters_left-counter").text("0");o({action:"epkb_get_question_data",question_id:t,_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce},function(o){o.error||void 0===o.data||(e("#epkb_help_question").val(o.data.title),e("#epkb_help_question_id").val(t),null==i?e("#epkb_help_editor").val(o.data.content):i.setContent(o.data.content),e(".epkb-help-wp-editor").addClass("active"))})}function d(){if(e("#epkb_help_question").length){let t=e("#epkb_help_question").val().length;t>200?(e(".epkb-help-wp-editor__question .epkb-characters_left-counter").text(200),e("#epkb_help_question").val(e("#epkb_help_question").val().substring(0,200))):e(".epkb-help-wp-editor__question .epkb-characters_left-counter").text(t)}if(e("#epkb_help_editor").length){let t=tinymce.get("epkb_help_editor"),o="";(o=t&&e(".wp-editor-wrap").hasClass("tmce-active")?t.getContent():e("#epkb_help_editor").val()).length>1500&&(o=o.substring(0,1500),t&&t.setContent(o),e("#epkb_help_editor").val(o)),e(".epkb-help-wp-editor__answer .epkb-characters_left-counter").text(o.length)}}function _(){0!=e(".epkb-location-notice--no-questions").length&&(e(".epkb-questions-list-container li").length?e(".epkb-location-notice--no-questions").addClass("epkb-location-notice--hidden"):e(".epkb-location-notice--no-questions").removeClass("epkb-location-notice--hidden"))}function r(){let t=e(".epkb-all-questions-list-container"),o=t.children(".epkb-question-container");o.detach().sort(function(t,o){let i=e(t).data("modified"),n=e(o).data("modified");return parseInt(i)<=parseInt(n)?0:-1}),t.append(o)}e(".epkb-admin__reload-link").on("click",function(){e('.epkb-admin__top-panel__item[data-target="'+e(this).attr("href").replace("#","")+'"]').trigger("click")}),t(),e("body").on("input",".epkb-hd-location-option-input",function(){let t=e(this),i=t.val(),n=t.data("post-type"),a=t.closest(".epkb-hd-location-option-select");i.length<3||setTimeout(function(){if(i!=t.val())return;o({action:"epkb_help_dialog_find_location_pages",search_value:i,search_post_type:n,location_id:e("#epkb-list-of-kbs").val(),_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce},function(e){console.log(e),a.find(".epkb-hd-location-option-search-results").html(e.data)},!1,!1,void 0,a.find(".epkb-hd-location-option-search-results"))},500)}),e("body").on("click",".epkb-hd-location-option-search-results li",function(){if("disabled"==e(this).attr("disabled"))return!0;let t=e(this).closest(".epkb-hd-location-option-select").find("input").data("post-type"),o=e(this).data("post-id");0==e(this).closest(".epkb-hd-location-option-select").find(".epkb-hd-location-option-list li[data-post-id="+o+"]").length&&e(this).closest(".epkb-hd-location-option-select").find(".epkb-hd-location-option-list").append('<li class="epkb-hd-location-option" data-post-id="'+e(this).data("post-id")+'" data-location-type="'+t+'">'+e(this).text()+"</li>"),e(this).remove()}),e("body").on("click",".epkb-hd-location-option",function(){e(this).remove()}),e(".epkb-questions-list-container").sortable({axis:"y",forceHelperSize:!0,forcePlaceholderSize:!0,placeholder:"epkb-sortable-placeholder",change:l}),e("#epkb-change-help-dialog-location select").on("change",function(){i("show",""),e(this).closest("form").submit()}),e(".epkb-hd-location-option-radio input").on("change",function(){"in"==e(this).val()?e(this).closest(".epkb-hd-location-container").find(".epkb-hd-location-option-input[data-include-type=except]").prev().html(""):e(this).closest(".epkb-hd-location-container").find(".epkb-hd-location-option-input[data-include-type=in]").prev().html("")}),e(document.body).on("click","#epkb_location",function(t){t.preventDefault();let n=e("#epkb-location-name").val();if(!n)return a(epkb_vars.location_name_required),void p(e("#epkb-location-name").closest(".epkb-s__input-row-container"));let l={page:[],post:[],cpt:[]},c={page:[],post:[],cpt:[]};if(e(".epkb-hd-location-option-list__page-in").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&e(".epkb-hd-location-option-list__page-in .epkb-hd-location-option").each(function(){l.page.push(e(this).data("post-id"))}),e(".epkb-hd-location-option-list__page-except").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&e(".epkb-hd-location-option-list__page-except .epkb-hd-location-option").each(function(){c.page.push(e(this).data("post-id"))}),e(".epkb-hd-location-option-list__post-in").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&e(".epkb-hd-location-option-list__post-in .epkb-hd-location-option").each(function(){l.post.push(e(this).data("post-id"))}),e(".epkb-hd-location-option-list__post-except").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&e(".epkb-hd-location-option-list__post-except .epkb-hd-location-option").each(function(){c.post.push(e(this).data("post-id"))}),e(".epkb-hd-location-option-list__cpt-in").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&e(".epkb-hd-location-option-list__cpt-in .epkb-hd-location-option").each(function(){l.cpt.push(e(this).data("post-id"))}),e(".epkb-hd-location-option-list__cpt-except").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&e(".epkb-hd-location-option-list__cpt-except .epkb-hd-location-option").each(function(){c.cpt.push(e(this).data("post-id"))}),0==c.page.length&&e(".epkb-hd-location-option-list__page-except").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&c.page.push(-1),0==c.post.length&&e(".epkb-hd-location-option-list__post-except").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&c.post.push(-1),0==c.cpt.length&&e(".epkb-hd-location-option-list__cpt-except").closest(".epkb-hd-location-option-wrap").find("input[type=radio]").prop("checked")&&c.page.push(-1),0==c.page.length&&0==c.post.length&&0==c.cpt.length&&0==l.page.length&&0==l.page.length&&0==l.page.length)return a(epkb_vars.location_pages_required),void p(e(".epkb-hd-location-container").closest(".epkb-admin__boxes-list__box"));let d=[];e(".epkb-help-dialog-kbs-container .epkb-settings-control__input__toggle:checked").each(function(){d.push(e(this).closest(".epkb-settings-control-type-toggle").data("field"))});o({action:"epkb_create_update_location",location_id:e("#epkb-list-of-kbs").val(),location_name:n,location_status:e("body").find("[name=epkb-location-status]:checked").val(),_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce,selected_pages:l,excluded_pages:c,kb_ids:d},function(t){if(!t.error&&void 0!==t.message){if(s(t.message),0==e("#epkb-list-of-kbs").val())e("#epkb-list-of-kbs").prepend('<option value="'+t.location_id+'">'+e("#epkb-location-name").val()+"</option>"),e("#epkb-list-of-kbs").val(t.location_id),i("show",""),e("#epkb-change-help-dialog-location").submit();else{let o=e("#epkb-list-of-kbs").find("option[value="+t.location_id+"]");o.length&&o.text(n)}void 0!==t.url&&t.url&&e(".epkb-admin__header__view-kb__link").length&&e(".epkb-admin__header__view-kb__link").prop("href",t.url),void 0!==t.editor_url&&t.editor_url&&e("#epkb-admin__boxes-list__frontend-editor a").length&&e("#epkb-admin__boxes-list__frontend-editor a").prop("href",t.editor_url)}},void 0,!1,function(t){t.error&&"term_exists"==t.error_code&&p(e("#epkb-location-name").closest(".epkb-toggle-setting-container"))})}),e(document.body).on("click",".epkb__hdl__action__cancel input",function(t){t.preventDefault();let o=e("#epkb-list-of-kbs").find("option").first().val();e("#epkb-list-of-kbs").val(o),i("show",""),e("#epkb-change-help-dialog-location").trigger("submit")}),e(document.body).on("click",".epkb__hdl__action__delete input",function(t){e("#epkb_help_location_delete_confirmation").addClass("epkb-dialog-box-form--active")}),e("#epkb_help_location_delete_confirmation form").on("submit",function(t){t.preventDefault();let n=e("#epkb_help_location_delete_confirmation_id").val();if(void 0===n||!n)return void a(epkb_vars.reload_try_again);return o({action:"epkb_delete_location",location_id:n,_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce},function(t){t.error||void 0===t.message||(s(t.message),e("#epkb-list-of-kbs").find("option[value="+t.location_id+"]").remove(),e("#epkb-list-of-kbs").val(e("#epkb-list-of-kbs").find("option").first().val()),i("show",""),e("#epkb-change-help-dialog-location").trigger("submit")),e("#epkb_help_dialog_delete_confirmation").removeClass("epkb-dialog-box-form--active")}),!1}),e("body").on("click",".epkb-close-notice",function(){let t=e(this).closest(".eckb-bottom-notice-message");t.addClass("fadeOutDown"),setTimeout(function(){t.html("")},1e3)});let b=!1;e(".epkb__help_editor__action__cancel, .epkb-help-wp-editor__overlay").on("click",function(t){return e(".epkb-help-wp-editor").removeClass("active"),clearInterval(b),!1}),e("#epkb-help-article-form").on("submit",function(){d(),tinyMCE.triggerSave();return o({action:"epkb_save_question_data",form:e(this).serialize(),_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce},function(o){if(!o.error&&void 0!==o.message){if(s(o.message),e(".epkb-question-"+o.data.id).length)e(".epkb-question-"+o.data.id+" .epkb-question__text").text(o.data.title);else{e(o.data.html).appendTo(".epkb-questions-list-container").addClass("ui-sortable-handle");e(o.data.html).appendTo(".epkb-all-questions-list-container").addClass("epkb-question-container-disabled")}e(".epkb-help-wp-editor").removeClass("active"),r(),l(),_(),t()}}),!1}),e("#epkb_help_add_new_question").on("click",function(){return c(),!1}),e("body").on("click",".epkb-question__edit",function(){let t=e(this).closest(".epkb-question-container").data("id");void 0!==t?c(t):a(epkb_vars.reload_try_again)}),e("#epkb_all_questions_filter").on("change keyup",function(){let t=e(this).val().toLowerCase();e(".epkb-all-questions-list-container .epkb-question-container").each(function(){let o=e(this).find(".epkb-question__text").text();0==t.length||~o.toLowerCase().indexOf(t)?e(this).show():e(this).hide()})}),e("body").on("click",".epkb-question__delete",function(){let t=e(this).closest(".epkb-question-container").data("id");void 0!==t&&t?(e("#epkb_help_dialog_delete_confirmation_id").val(t),e("#epkb_help_dialog_delete_confirmation").addClass("epkb-dialog-box-form--active")):a(epkb_vars.reload_try_again)}),e("#epkb_help_dialog_delete_confirmation form").on("submit",function(){let i=e("#epkb_help_dialog_delete_confirmation_id").val();if(void 0===i||!i)return void a(epkb_vars.reload_try_again);return o({action:"epkb_delete_question",id:i,_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce},function(o){o.error||void 0===o.message||(s(o.message),e(".epkb-question-"+i).remove()),e("#epkb_help_dialog_delete_confirmation").removeClass("epkb-dialog-box-form--active"),_(),t()}),!1}),e("body").on("click",".epkb-question__move_right",function(){let t=e(this).closest(".epkb-question-container").data("id");void 0!==t&&t?(e(".epkb-questions-list-container").find(".epkb-question-"+t).remove(),e(".epkb-help-dialog-all-questions").find(".epkb-question-"+t).removeClass("epkb-question-container-disabled"),l(),_()):a(epkb_vars.reload_try_again)}),e("body").on("click",".epkb-question__move_left",function(){let t=e(this).closest(".epkb-question-container").data("id");if(void 0===t||!t)return void a(epkb_vars.reload_try_again);if(e(this).closest(".epkb-question-container").addClass("epkb-question-container-disabled"),e(".epkb-questions-list-container").find(".epkb-question-"+t).length)return;let o=e(this).closest(".epkb-question-container").clone();o.removeClass("epkb-question-container-disabled"),o.addClass("ui-sortable-handle"),o.appendTo(".epkb-questions-list-container"),l(),_()}),e(".epkb__hdl__action__save_order .epkb-success-btn").on("click",function(){let t={action:"epkb_save_help_questions_order",location:e("#epkb-list-of-kbs").val(),questions_order:[],_wpnonce_epkb_ajax_action:epkb_help_dialog_vars.nonce};e(".epkb-questions-list-container .epkb-question-container").each(function(){t.questions_order.push(e(this).data("id"))}),o(t,function(t){t.error||void 0===t.message||(s(t.message),e("#epkb-admin__boxes-list__questions .epkb-admin__list-actions-row .epkb-success-btn").css({visibility:"hidden"}),e("#epkb-admin__boxes-list__questions .epkb-admin__list-actions-row .epkb-error-btn").css({visibility:"hidden"}))})}),e(".epkb-question__delete").on("mouseenter",function(){e(this).closest(".epkb-question-container").addClass("epkb-question-container--delete-hightlight")}),e(".epkb-question__delete").on("mouseleave",function(){e(this).closest(".epkb-question-container").removeClass("epkb-question-container--delete-hightlight")}),e(".epkb-question__move_left").on("mouseenter",function(){e(this).closest(".epkb-question-container").addClass("epkb-question-container--move_left-hightlight")}),e(".epkb-question__move_left").on("mouseleave",function(){e(this).closest(".epkb-question-container").removeClass("epkb-question-container--move_left-hightlight")}),e(".epkb-question__move_right").on("mouseenter",function(){e(this).closest(".epkb-question-container").addClass("epkb-question-container--move_right-hightlight")}),e(".epkb-question__move_right").on("mouseleave",function(){e(this).closest(".epkb-question-container").removeClass("epkb-question-container--move_right-hightlight")}),e(".epkb-question__edit").on("mouseenter",function(){e(this).closest(".epkb-question-container").addClass("epkb-question-container--edit-hightlight")}),e(".epkb-question__edit").on("mouseleave",function(){e(this).closest(".epkb-question-container").removeClass("epkb-question-container--edit-hightlight")}),r(),_(),e("body").on("click",".epkb__hdl__action__reload input",function(){location.reload()})});