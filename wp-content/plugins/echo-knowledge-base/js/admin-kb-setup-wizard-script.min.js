jQuery(document).ready(function(e){function t(t){s.find(".epkb-wizard-status-bar .epkb-wsb-step").removeClass("epkb-wsb-step--completed"),s.find(".epkb-wizard-status-bar .epkb-wsb-step").each(function(){let a=e(this).attr("id");a[a.length-1]<t&&e(this).addClass("epkb-wsb-step--completed")})}function a(){e("html, body").animate({scrollTop:0},0)}function n(t,a){if("show"===t){let t='<div class="epkb-admin-dialog-box-loading"><div class="epkb-admin-dbl__header"><div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(a?'<div class="epkb-admin-text">'+a+"</div>":"")+'</div></div><div class="epkb-admin-dialog-box-overlay"></div>';e("body").append(t)}else"remove"===t&&(e(".epkb-admin-dialog-box-loading").remove(),e(".epkb-admin-dialog-box-overlay").remove())}function i(e,t,a){return'<div class="eckb-bottom-notice-message"><div class="contents"><span class="'+a+'">'+(e?"<h4>"+e+"</h4>":"")+(t||"")+"</span></div></div>"}let s=e("#epkb-config-wizard-content");if(s.length<=0)return;let o=e(".epkb-admin__error-form__container");s.find(".epkb-setup-wizard-button-apply").on("click",function(t){let a=[],s={action:"epkb_apply_setup_wizard_changes",_wpnonce_apply_wizard_changes:e("#_wpnonce_apply_wizard_changes").val(),epkb_wizard_kb_id:e("#epkb_wizard_kb_id").val()},p=e('input[name="epkp-theme"]:checked').val();void 0===p&&(p="standard"),e(".epkb-menu-checkbox input[type=checkbox]:checked").length&&e(".epkb-menu-checkbox input[type=checkbox]:checked").each(function(){a.push(e(this).prop("name").split("epkb_menu_")[1])}),s.theme_name=p,s.kb_name=e(".epkb-wizard-name input").val(),s.kb_slug=e(".epkb-wizard-slug input").val(),s.menu_ids=a,function(t,a,s,p,r=!1){let d,c;a=void 0===a?"epkb_callback_noop":a,e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,beforeSend:function(e){r||n("show",p)}}).done(function(e){(c=e||"").error||void 0===c.message?d=c.message?c.message:i("",epkb_vars.reload_try_again,"error"):c.redirect_to_url&&c.redirect_to_url.length>0&&(window.location=c.redirect_to_url)}).fail(function(e,t,a){d=a?" ["+a+"]":epkb_vars.unknown_error,d=i(epkb_vars.error_occurred+". "+epkb_vars.msg_try_again,d,"error")}).always(function(){r||n("remove",""),d?(e(o).find(".epkb-admin__error-form__title").text(epkb_vars.setup_wizard_error_title),e(o).find(".epkb-admin__error-form__desc").text(epkb_vars.setup_wizard_error_desc),e(o).find("#epkb-admin__error-form__message").val(e(d).text().trim()),e(o).css("display","block","important")):"function"==typeof a?a(c=void 0===c?"":c):s&&location.reload()})}(s)}),s.find(".epkb-setup-wizard-button-next").on("click",function(n){n.preventDefault();let i=Number(s.find("#epkb-setup-wizard-button-next").val());e(".epkb-wsb-step").removeClass("epkb-wsb-step--active"),e("#epkb-wsb-step-"+i).addClass("epkb-wsb-step--active"),e(".epkb-wc-step-panel").removeClass("epkb-wc-step-panel--active"),e(".epkb-wc-step-panel-button").removeClass("epkb-wc-step-panel-button--active"),e("#epkb-wsb-step-"+i+"-panel").addClass("epkb-wc-step-panel--active"),e(".epkb-wsb-step-"+i+"-panel-button").addClass("epkb-wc-step-panel-button--active"),e(".epkb-wizard-top-bar").show(),t(i),a()}),s.find(".epkb-setup-wizard-button-prev").on("click",function(n){n.preventDefault();let i=Number(s.find("#epkb-setup-wizard-button-prev").val());e(".epkb-wsb-step").removeClass("epkb-wsb-step--active"),e("#epkb-wsb-step-"+i).addClass("epkb-wsb-step--active"),e(".epkb-wc-step-panel").removeClass("epkb-wc-step-panel--active"),e(".epkb-wc-step-panel-button").removeClass("epkb-wc-step-panel-button--active"),e("#epkb-wsb-step-"+i+"-panel").addClass("epkb-wc-step-panel--active"),e(".epkb-wsb-step-"+i+"-panel-button").addClass("epkb-wc-step-panel-button--active"),e(".epkb-wizard-top-bar").hide(),t(i),a()}),e(".epkb-setup-option__option__label").on("click",function(){e(".epkb-setup-option-container").removeClass("epkb-setup-option-container--active"),e(this).closest(".epkb-setup-option-container").addClass("epkb-setup-option-container--active")}),e('.epkb-wizard-slug input[type="text"]').on("input",function(){e("#epkb-wizard-slug-target").text(e(this).val())}),s.find(".epkb-setup-option__featured-img-container").on("click",function(t){t.preventDefault(),t.stopPropagation(),s.find(".image_zoom").remove();var a,n=e(this).find("img");a=n.length>1?e(n[0]).is(":visible")?e(n[0]).attr("src"):e(n[1]).is(":visible")?e(n[1]).attr("src"):e(n[2]).attr("src"):e(this).find("img").attr("src"),e(this).after('<div id="epkb_image_zoom" class="image_zoom"><img src="'+a+'" class="image_zoom"><span class="close epkbfa epkbfa-close"></span></div>'),e("html, body").on("click",function(){e("#epkb_image_zoom").remove(),e("html, body").off("click")})}),e(document).on("click",".epkb-close-notice",function(){e(this).parent().addClass("fadeOutDown")}),e(o).on("click",".epkb-close-notice, .epkb-admin__error-form__btn-cancel",function(){window.location=epkb_vars.need_help_url}),e(o).find("#epkb-admin__error-form").on("submit",function(t){t.preventDefault();let a=e(this);t.data;e.ajax({type:"POST",dataType:"json",url:ajaxurl,data:a.serialize(),beforeSend:function(t){e(o).find("input, textarea").prop("disabled","disabled"),e(o).find(".epkb-admin__error-form__response").html(epkb_vars.sending_error_report)}}).done(function(t){void 0!==t.success&&0==t.success?e(o).find(".epkb-admin__error-form__response").html(t.data):void 0!==t.success&&1==t.success?e(o).find(".epkb-admin__error-form__response").html(t.data):e(o).find(".epkb-admin__error-form__response").html(epkb_vars.send_report_error)}).fail(function(t,a,n){e(o).find(".epkb-admin__error-form__response").html(epkb_vars.send_report_error)}).always(function(){e(o).find("input, textarea").prop("disabled",!1),setTimeout(function(){window.location=epkb_vars.need_help_url},1e3)})}),e(document).on("click",".epkb-notice-dismiss",function(t){t.preventDefault(),e(".notice-"+e(this).data("notice-id")).slideUp();var a={action:"epkb_dismiss_ongoing_notice",epkb_dismiss_id:e(this).data("notice-id")};e.ajax({type:"POST",dataType:"json",url:ajaxurl,data:a})})});